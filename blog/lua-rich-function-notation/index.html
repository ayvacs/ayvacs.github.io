<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="/styles/colours.css">
    <link rel="stylesheet" href="/styles/blogpost.css">
    <base target="_blank">
</head>

<body>
    <div id="blog_main">
        <h3 id="header">AYVACS <a href="../../">home</a></h3>
        <p id="date">Jul 28, 2024</p>
        <h1>lua rich function notation</h1>

        <hr>

        <div id="blog-content"><pre><code class="language-lua">local myButton = new &quot;TextButton&quot; {
    [&quot;Size&quot;] = UDim2.new(0, 250, 0, 100),
    [&quot;Text&quot;] = &quot;Click me to do something cool&quot;,
    [&quot;*MouseButton1Click&quot;] = (function()
        print(&quot;Left mouse button clicked!&quot;)
    end)
}
</code></pre>
<p>The above script might look a bit odd for a Lua function. After all, there are no parentheses or commas used in the <code>new</code> function, yet somehow both a string and table are being passed as arguments to it.</p>
<p>However, this notation only makes use of vanilla Lua features and runs as expected, with no errors... so how does it work?</p>
<p>This has to do with the fact that in Lua you can actually call a function that takes a string or table <em>without parentheses</em>.</p>
<p>Under the hood, two functions are actually being ran; <code>new</code> and the function that <code>new</code> returns. So the following code block produces identical results to the first:</p>
<pre><code class="language-lua">local newButton = new &quot;TextButton&quot;

local myButton = newButton {
    [&quot;Size&quot;] = UDim2.new(0, 250, 0, 100),
    [&quot;Text&quot;] = &quot;Click me to do something cool&quot;,
    [&quot;*MouseButton1Click&quot;] = (function()
        print(&quot;Left mouse button clicked!&quot;)
    end)
}
</code></pre>
<p>The source for the <code>new.lua</code> ModuleScript looks a little something like this:</p>
<pre><code class="language-lua">return function(className)
    return function(properties)
        -- ...
    end
end
</code></pre>
<p>We can see the definition of the initial function that takes in a <code>ClassName</code>, which returns a second function with the properties table as a parameter.</p>
<p>This was a technique I made use of in my <a href="https://github.com/ayvacs/Proton">Proton UI library</a> to allow for easily human-readable generation of UI instances in the Roblox platform. I made use of this technique once more, with the <code>onEvent</code> expression...</p>
<pre><code class="language-lua">local btn = new &quot;TextButton&quot; {
    [onEvent &quot;MouseButton1Click&quot;] = function()
      print(&quot;Left mouse button clicked!&quot;)
    end
}
</code></pre>
<p>In reality, <code>onEvent</code> is simply a <em>function</em> that appends an asterisk to the string parameter. So, <code>onEvent &quot;foo&quot;</code> is equal to <code>*foo</code>. This lets the Proton compiler know that we want to attach the function <code>*foo</code> to the event <code>foo</code>. It's super readable easy to understand, and it's all written in vanilla Lua!</p>
<p>You can view the full source code of the <code>new</code> function <a href="https://github.com/ayvacs/Proton/blob/main/src/Proton/modules/new.luau">here</a>!</p>
</div>

        <hr>

        <p id="copyright">&copy; 2024 ayvacs. all rights reserved. <a id="view-source"></a></p>
    </div>

    <!-- Add view edit history btn -->
    <script>
        const pageurl = "/blog/lua-rich-function-notation/";
        const btn = document.getElementById("view-source");

        btn.href = `https://github.com/ayvacs/ayvacs.github.io/commits/main/docs${ pageurl.substring(0, pageurl.length - 1) }.md`;
        btn.textContent = "view edit history";
    </script>

    <!-- Add hightlight.js syntax highlighting for codeblocks -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/vs2015.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
    <style>
        /* hljs override styles */
                .hljs { background: none; }
        pre code.hljs { padding: 0; }
    </style>
</body>

</html>